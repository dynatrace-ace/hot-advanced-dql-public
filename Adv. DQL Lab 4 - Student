{"version":"6","defaultTimeframe":{"from":"now()-2h","to":"now()"},"sections":[{"id":"92c16eac-9eea-4f35-8377-bcb2e2346316","type":"markdown","markdown":"# Adv. DQL - Lab 4\n---"},{"id":"332367a4-966e-47e3-8873-cf1ee34aa56a","type":"markdown","markdown":"## 4.1 General DQL"},{"id":"e8c913b4-dec6-4cdf-b4c5-8b8e85f7c454","type":"markdown","markdown":"#### 4.1.1 Host Health Tile: \n\nOne of the templated features in classic Dynatrace dashboards is the health tile displaying green or red depending on if the entity was impacted by a problem. Use DQL to duplicate this behaviour by implementing a Host Health tile.\n\n**Task**:\n\n- Find a way to implement the host health tile using DQL\n- You may want to add a status field indicating if the host has a problem\n- You may also want to add a custom colour scheme that references the status"},{"id":"0ec2fca5-c8d4-41f1-aa60-c2a121ef85c1","type":"dql","showTitle":false,"filterSegments":[],"drilldownPath":[],"state":{"input":{"value":"fetch dt.entity.host","timeframe":{"from":"now()-2h","to":"now()"}},"visualization":"honeycomb","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"result":{"code":200,"value":{"records":[{"entity.name":"lnx1-demo.c.dynatrace-demoability.internal","id":"HOST-CDD2F9BB85A2DA68"},{"entity.name":"i-061c82f7d0e098b13","id":"HOST-273EF88BEFED7C70"},{"entity.name":"i-0366a836f9aee5f51","id":"HOST-B63426FD95D1B9EC"},{"entity.name":"i-0cf1f2730768b7250","id":"HOST-A0D0407E9F620807"},{"entity.name":"i-0d611f7adcde23fd3","id":"HOST-5143BFBC3C40AC2D"}],"metadata":{"grail":{"canonicalQuery":"fetch dt.entity.host","timezone":"Europe/London","query":"fetch dt.entity.host","scannedRecords":5,"dqlVersion":"V1_0","scannedBytes":0,"scannedDataPoints":0,"analysisTimeframe":{"start":"2025-01-02T12:17:29.636Z","end":"2025-01-02T14:17:29.636Z"},"locale":"en-US","executionTimeMilliseconds":28,"notifications":[],"queryId":"ed39c9e2-0d6c-42e2-9206-95550251857c","sampled":false}},"types":[{"mappings":{"entity.name":{"type":"string"},"id":{"type":"string"}},"indexRange":[0,4]}]},"notifications":[],"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"dateTime":"2025-01-02T14:17:30.010Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch dt.entity.host"}},"visualizationSettings":{"thresholds":[],"chartSettings":{"xAxisScaling":"analyzedTimeframe","gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"vertical","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","categoryAxis":["entity.name","id"],"categoryAxisLabel":"entity.name,id","valueAxis":[],"valueAxisLabel":"","tooltipVariant":"single"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle"},"singleValue":{"showLabel":true,"label":"entity.name","prefixIcon":"","recordField":"entity.name","autoscale":true,"alignment":"center","trend":{"trendType":"auto","isVisible":true},"colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"firstVisibleRowIndex":0,"columnWidths":{},"columnTypeOverrides":[]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"displayedFields":["entity.name","id"],"dataMappings":{"value":"entity.name"},"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical","customColors":[{"id":0,"value":"OK","comparator":"=","color":{"Default":"var(--dt-colors-charts-categorical-color-09-default, #649438)"}},{"id":2468380.2,"value":"Problem","comparator":"=","color":{"Default":"var(--dt-colors-charts-loglevel-emergency-default, #ae132d)"}}]},"histogram":{"legend":"auto","yAxis":{"label":"Frequency","scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle","displayedFields":["entity.name","id"]}},"state":"success"},"previousFilterSegments":[]},{"id":"0e0bc197-e1a3-46ef-bf2e-3cf49e31ea21","type":"markdown","markdown":"### 4.1.2 Multiple Timeseries: \n\nCurrently you organisation is experiencing some networking issues and believe it could be related to the F5 instances. You have been tasked to chart the total network utilization (in and out) of your F5 instances and to show if they are above 30TB usage in the last 2 hours\n\n**Task**:\n\n- Find a way to implement the above requirements\n- You can utilse the following metrics `com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.in.count` and `com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.out.count`\n- Remember to add correct overides for the data (Bytes) and thresholds would be useful to see breaches"},{"id":"cf07565c-5a2b-4121-b122-143f490260e4","type":"dql","showTitle":false,"filterSegments":[],"drilldownPath":[],"state":{"input":{"value":"timeseries BytesRecieved = sum(com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.in.count)","timeframe":{"from":"now()-2h","to":"now()"}},"visualization":"lineChart","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"result":{"code":200,"value":{"records":[{"timeframe":{"start":"2025-01-02T12:20:00.000Z","end":"2025-01-02T14:21:00.000Z"},"interval":"60000000000","BytesRecieved":[1125311374845,1123648789982,1122963086842,1121192182986,1123647481884,1119124383282,1122413141609,1123684582529,1120916611870,1121871467495,1122750493990,1125501833909,1124183119425,1123253562495,1120326050268,1124286495240,1122326420342,1122541553418,1122299721790,1120872698450,1122279283316,1116905705218,1126608847720,1120461190277,1124347652103,1121686742504,1124163615504,1120332077559,1120993939499,1123877222824,1124255641328,1120103244000,1126257809968,1118985125274,1122608150944,1121436682165,1121289804424,1124460128476,1120928339274,1124818870864,1121044555914,1121344850294,1123270438497,1118785131280,1126234366950,1118797771859,1120639694461,1121423866580,1124324305865,1117522571295,1123614071307,1123783272886,1125725815278,1123277894974,1123764510186,1120247553578,1121031518669,1123214431415,1121393115680,1119504687871,1122539998210,1126506884653,1122146029297,1122973313306,1122284559690,1123950956571,1121871834126,1125069440910,1119872783331,1123738842620,1121165139895,1123434062212,1120044166151,1125998399466,1121640103323,1121818968074,1123230975116,1121089730883,1122809179671,1122230856598,1121087268569,1125462208018,1121320941709,1121237422550,1123717169473,1119590240507,1121054880398,1123794096211,1119970204067,1125180134057,1120150881207,1119362160919,1122700299256,1124563443029,1123202863612,1118334275110,1121743284933,1124704662614,1121389000473,1127567043127,1121080768745,1119880088605,1124138126405,1123481670530,1121301612943,1122093283802,1124133339673,1123215824418,1122648918751,1122820266055,1126465755097,1119526130875,1122429275731,1125633574035,1122746157785,1123386801332,1122254834379,1120445476778,1124337057436,1124084124862,null]}],"metadata":{"grail":{"canonicalQuery":"timeseries BytesRecieved = sum(com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.in.count)","timezone":"Europe/London","query":"timeseries BytesRecieved = sum(com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.in.count)","scannedRecords":0,"dqlVersion":"V1_0","scannedBytes":0,"scannedDataPoints":6040,"analysisTimeframe":{"start":"2025-01-02T12:20:00.000Z","end":"2025-01-02T14:21:00.000Z"},"locale":"en-US","executionTimeMilliseconds":31,"notifications":[],"queryId":"f1fc8b04-bfa2-424c-9544-139a99927a5d","sampled":false},"metrics":[{"metric.key":"com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.in.count","displayName":"Bytes received","description":"The number of bytes received on the specified interface.","unit":"By","fieldName":"BytesRecieved"}]},"types":[{"mappings":{"timeframe":{"type":"timeframe"},"interval":{"type":"duration"},"BytesRecieved":{"type":"array","types":[{"mappings":{"element":{"type":"double"}},"indexRange":[0,120]}]}},"indexRange":[0,0]}]},"notifications":[],"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"dateTime":"2025-01-02T14:20:01.463Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"timeseries BytesRecieved = sum(com.dynatrace.extension.f5.bigip.sys.interface.stat.bytes.in.count)"}},"visualizationSettings":{"thresholds":[],"chartSettings":{"xAxisScaling":"analyzedTimeframe","gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"vertical","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","categoryAxisLabel":"interval","valueAxisLabel":"interval","tooltipVariant":"single","categoryAxis":["interval"],"valueAxis":["interval"]},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle","hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["BytesRecieved"]},"xAxisLabel":"timeframe","xAxisIsLabelVisible":false,"leftYAxisSettings":{"isLabelVisible":true,"label":"Bytes received"}},"singleValue":{"showLabel":true,"label":"instance.name","prefixIcon":"","recordField":"instance.name","autoscale":true,"alignment":"center","trend":{"trendType":"auto","isVisible":true},"colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"firstVisibleRowIndex":0,"columnWidths":{},"columnTypeOverrides":[{"fields":["BytesRecieved"],"value":"sparkline","id":1735827601466}],"colorThresholdTarget":"background","enableThresholdInRow":false,"selectedColumnForRowThreshold":"TotalNetworkThroughput"},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"displayedFields":[],"dataMappings":{},"truncationMode":"middle","colorMode":"color-palette","colorPalette":"blue"},"histogram":{"legend":"auto","yAxis":{"label":"Frequency","scale":"linear"},"colorPalette":"categorical","dataMappings":[{"valueAxis":"interval","rangeAxis":""}],"variant":"single","truncationMode":"middle","displayedFields":[]},"unitsOverrides":[],"autoSelectVisualization":false},"state":"success"},"previousFilterSegments":[]},{"id":"5eecb9bd-6d8f-4fcc-99ad-91f8f5b29a8e","type":"markdown","markdown":"## 4.2 Demo / Extras"},{"id":"5645fcb9-01b3-4098-a4c8-c8acd146aef7","type":"markdown","markdown":"### 4.2.1 DQL in a code: \n\nIn some cases you may want to enhance your DQL queries with external or non-grail data. In the example below we use Javascript to corralate if the bigger spenders for an applications have a better user experience score. This uses a combination of usql and DQL as RUM data is not yet available in Grail."},{"id":"516ea310-9650-46e3-a9cf-5006b35719f8","type":"function","showTitle":false,"drilldownPath":[],"showInput":false,"state":{"input":{"value":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nimport { queryExecutionClient } from \"@dynatrace-sdk/client-query\";\n\nexport default async function () {\n  const queryData = await queryExecutionClient.queryExecute({\n    body: {\n      query: 'fetch bizevents , from:-2h , to:now() | filter isNotNull(dt.rum.application.id) AND isNotNull(cardType) | fields name , amount , cardType , dt.rum.session.id | sort amount desc | limit 5',\n    },\n  });\n\n  setTimeout(() => {}, 2500);\n\n  const completedData = await queryExecutionClient.queryPoll({\n    requestToken: queryData.requestToken,\n  });\n\n  const combinedData = await Promise.all(completedData.result.records.map(async (record) => {\n    const usqlQuery = `SELECT userSessionId , userExperienceScore FROM usersession WHERE userSessionId = \"${record[\"dt.rum.session.id\"]}\"`;\n    const usqlResponse = await rumUserSessionsClient.getUsqlResultAsTable({ query: usqlQuery });\n\n    const userExperienceScore = usqlResponse.values.length > 0 ? usqlResponse.values : 'UNKNOWN';\n\n    return {\n      name: record.name,\n      amount: record.amount.toFixed(2),\n      cardType: record.cardType,\n      sessionId: record[\"dt.rum.session.id\"],\n      userExperienceScore: userExperienceScore\n    };\n  }));\n\n  const sampleCount = combinedData.length;\n\n  return {\n    records: combinedData.map((record, index) => ({\n      'Name': record.name,\n      'Amount': record.amount,\n      'CardType': record.cardType,\n      'UserExperienceScore': record.userExperienceScore[0][1]\n    })),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Name': { type: 'string' },\n          'Amount': { type: 'Double' },\n          'CardType': { type: 'string' },\n          'UserExperienceScore': { type: 'string' }\n        }\n      }\n    ]\n  };\n}","timeframe":{"from":"now()-2h","to":"now()"}},"state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"xAxisScaling":"analyzedTimeframe","gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"vertical","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","categoryAxis":"Name","categoryAxisLabel":"Name","valueAxis":[],"valueAxisLabel":"","tooltipVariant":"single"},"colorPalette":"categorical","truncationMode":"middle"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"Name","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"firstVisibleRowIndex":0,"columnWidths":{},"columnTypeOverrides":[]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"categorical","dataMappings":{"value":"Name"},"displayedFields":["Name","CardType","UserExperienceScore"]},"histogram":{"legend":"auto","yAxis":{"label":"Frequency","scale":"linear"},"colorPalette":"categorical","dataMappings":[]}},"result":{"code":200,"value":{"records":[{"Name":"Robin Garcia","Amount":"4523.11","CardType":"visaCredit"},{"Name":"Janice Castro","Amount":"4397.90","CardType":"mastercard","UserExperienceScore":"SATISFIED"},{"Name":"Brittany Miller","Amount":"3880.97","CardType":"visaCredit","UserExperienceScore":"SATISFIED"},{"Name":"Tracy Wright","Amount":"3794.34","CardType":"visaDebit","UserExperienceScore":"SATISFIED"},{"Name":"Brittany Miller","Amount":"3383.66","CardType":"visaCredit","UserExperienceScore":"SATISFIED"}],"metadata":{},"types":[{"mappings":{"Name":{"type":"string"},"Amount":{"type":"Double"},"CardType":{"type":"string"},"UserExperienceScore":{"type":"string"}},"indexRange":[0,5]}]},"logs":"","dateTime":"2024-10-18T13:37:01.356Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nimport { queryExecutionClient } from \"@dynatrace-sdk/client-query\";\n\nexport default async function () {\n  const queryData = await queryExecutionClient.queryExecute({\n    body: {\n      query: 'fetch bizevents , from:-2h , to:now() | filter isNotNull(dt.rum.application.id) AND isNotNull(cardType) | fields name , amount , cardType , dt.rum.session.id | sort amount desc | limit 5',\n    },\n  });\n\n  setTimeout(() => {}, 2500);\n\n  const completedData = await queryExecutionClient.queryPoll({\n    requestToken: queryData.requestToken,\n  });\n\n  const combinedData = await Promise.all(completedData.result.records.map(async (record) => {\n    const usqlQuery = `SELECT userSessionId , userExperienceScore FROM usersession WHERE userSessionId = \"${record[\"dt.rum.session.id\"]}\"`;\n    const usqlResponse = await rumUserSessionsClient.getUsqlResultAsTable({ query: usqlQuery });\n\n    const userExperienceScore = usqlResponse.values.length > 0 ? usqlResponse.values : 'UNKNOWN';\n\n    return {\n      name: record.name,\n      amount: record.amount.toFixed(2),\n      cardType: record.cardType,\n      sessionId: record[\"dt.rum.session.id\"],\n      userExperienceScore: userExperienceScore\n    };\n  }));\n\n  const sampleCount = combinedData.length;\n\n  return {\n    records: combinedData.map((record, index) => ({\n      'Name': record.name,\n      'Amount': record.amount,\n      'CardType': record.cardType,\n      'UserExperienceScore': record.userExperienceScore[0][1]\n    })),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Name': { type: 'string' },\n          'Amount': { type: 'Double' },\n          'CardType': { type: 'string' },\n          'UserExperienceScore': { type: 'string' }\n        }\n      }\n    ]\n  };\n}"}},"visualization":"table"}},{"id":"a07c3a5e-f56a-471b-9abc-db828a3c4133","type":"markdown","markdown":"### 4.2.2 Alternatives to Lookups:\nYour colleague has been looking and studying up on DQL he is sure that the below DQL can be done without using lookups. Using the below DQL as a reference , implement an indetical query without using lookups.\n\n**Task**:\n\nFind a way to implement the above requirements\nYou cannot use the lookup functionality\nMaybe interacting with the entities directly might help\nAs this is a demo env the data here is a little odd , a bar or area chart will show much better results"},{"id":"03d6371b-ba50-40ce-bf39-1b6bd9b86fef","type":"dql","showTitle":false,"filterSegments":[],"drilldownPath":[],"state":{"input":{"value":"timeseries avg(dt.service.request.count) , by:{dt.entity.service}\n| lookup [ fetch dt.entity.service ] , sourceField:dt.entity.service , lookupField:id , fields:{databaseVendor , entity.detected_name}\n| filter isNotNull(databaseVendor)\n| fieldsAdd ProcessedName = concat(entity.detected_name , \" - \" , databaseVendor)\n| fieldsKeep timeframe , interval , `avg(dt.service.request.count)` , ProcessedName\n","timeframe":{"from":"now()-2h","to":"now()"}},"visualization":"lineChart","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"result":{"code":200,"value":{"records":[{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"ProcessedName":"TradeManagement - SQL Server"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"ProcessedName":"easyTravelBusiness - Derby Client"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,null],"ProcessedName":"[embedded] - H2"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"ProcessedName":"TradeManagement - SqlConnection"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"ProcessedName":"memberships - MySQL"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null],"ProcessedName":"my_database - MySQL"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null],"ProcessedName":"likeDb - MySQL"},{"timeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"interval":"60000000000","avg(dt.service.request.count)":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null],"ProcessedName":"user-info-table-discover in us-east-1 - AWS"}],"metadata":{"grail":{"canonicalQuery":"timeseries by:{dt.entity.service}, avg(dt.service.request.count)\n| lookup [fetch dt.entity.service], sourceField:dt.entity.service, lookupField:id, fields:{databaseVendor, entity.detected_name}\n| filter isNotNull(databaseVendor)\n| fieldsAdd ProcessedName = concat(entity.detected_name, \" - \", databaseVendor)\n| fieldsKeep timeframe, interval, `avg(dt.service.request.count)`, ProcessedName","timezone":"Europe/London","query":"timeseries avg(dt.service.request.count) , by:{dt.entity.service}\n| lookup [ fetch dt.entity.service ] , sourceField:dt.entity.service , lookupField:id , fields:{databaseVendor , entity.detected_name}\n| filter isNotNull(databaseVendor)\n| fieldsAdd ProcessedName = concat(entity.detected_name , \" - \" , databaseVendor)\n| fieldsKeep timeframe , interval , `avg(dt.service.request.count)` , ProcessedName\n\n// Answer\n//timeseries avg(dt.service.request.count) , by:{dt.entity.service}\n//| filter in(dt.entity.service , classicEntitySelector(\"type(SERVICE) AND serviceType(DATABASE_SERVICE)\"))\n//| fieldsAdd dt.entity.service.name = concat(entityName(dt.entity.service) , \" - \" , entityAttr(dt.entity.service , \"databaseVendor\"))\n","scannedRecords":96,"dqlVersion":"V1_0","scannedBytes":0,"scannedDataPoints":24805,"analysisTimeframe":{"start":"2024-10-20T09:54:00.000Z","end":"2024-10-20T11:55:00.000Z"},"locale":"en-US","executionTimeMilliseconds":153,"notifications":[],"queryId":"2e5bb862-fdb3-4c0b-925c-b54acbb7998a","sampled":false},"metrics":[{"metric.key":"dt.service.request.count","displayName":"Service request count","description":"Number of requests received by a given service. To learn how Dynatrace detects and analyzes services, see [Services](https://dt-url.net/am-services).","unit":"count","fieldName":"avg(dt.service.request.count)"}]},"types":[{"mappings":{"timeframe":{"type":"timeframe"},"interval":{"type":"duration"},"avg(dt.service.request.count)":{"type":"array","types":[{"mappings":{"element":{"type":"double"}},"indexRange":[0,120]}]},"ProcessedName":{"type":"string"}},"indexRange":[0,7]}]},"notifications":[],"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"dateTime":"2024-10-20T11:54:40.199Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"timeseries avg(dt.service.request.count) , by:{dt.entity.service}\n| lookup [ fetch dt.entity.service ] , sourceField:dt.entity.service , lookupField:id , fields:{databaseVendor , entity.detected_name}\n| filter isNotNull(databaseVendor)\n| fieldsAdd ProcessedName = concat(entity.detected_name , \" - \" , databaseVendor)\n| fieldsKeep timeframe , interval , `avg(dt.service.request.count)` , ProcessedName\n\n// Answer\n//timeseries avg(dt.service.request.count) , by:{dt.entity.service}\n//| filter in(dt.entity.service , classicEntitySelector(\"type(SERVICE) AND serviceType(DATABASE_SERVICE)\"))\n//| fieldsAdd dt.entity.service.name = concat(entityName(dt.entity.service) , \" - \" , entityAttr(dt.entity.service , \"databaseVendor\"))\n"}},"visualizationSettings":{"thresholds":[],"chartSettings":{"xAxisScaling":"analyzedTimeframe","gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"vertical","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","categoryAxis":"ProcessedName","categoryAxisLabel":"ProcessedName","valueAxis":["interval"],"valueAxisLabel":"interval","tooltipVariant":"single"},"colorPalette":"categorical","truncationMode":"middle","hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["avg(dt.service.request.count)"],"leftAxisDimensions":["ProcessedName"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"ProcessedName","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"firstVisibleRowIndex":0,"columnWidths":{},"columnTypeOverrides":[]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"interval"},"displayedFields":["ProcessedName"]},"histogram":{"legend":"auto","yAxis":{"label":"Frequency","scale":"linear"},"colorPalette":"categorical","dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"state":"success"}},{"id":"9a48d15d-afb0-4aa3-8f68-fd7eac2970ac","type":"markdown","markdown":"### 4.2.3 Extending Relationships: \n\n**Task**:\n\n- Enhance the below code to additionally add the namespace to the name of the fields\n- The database services will not have a reference to the namespace they inhabit maybe the process might be able to help you\n- You can assume that the first Process Group Instance will be the one you want the namespace to be collected from"},{"id":"b5e98650-d2bf-442f-867e-95bea84edd7d","type":"dql","showTitle":false,"filterSegments":[],"state":{"input":{"value":"timeseries avg(dt.service.request.count) , by:{dt.entity.service}\n| lookup [ fetch dt.entity.service ] , sourceField:dt.entity.service , lookupField:id , fields:{databaseVendor , entity.detected_name}\n| filter isNotNull(databaseVendor)\n| fieldsAdd ProcessedName = concat(entity.detected_name , \" - \" , databaseVendor)\n| fieldsKeep timeframe , interval , `avg(dt.service.request.count)` , ProcessedName","timeframe":{"from":"now()-2h","to":"now()"}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"state":"idle","visualizationSettings":{}}}],"defaultSegments":[]}